<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dash</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1 id="header-title">
        <a href="#/" class="header-home-link">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          Dash
        </a>
        <span id="breadcrumb-separator" class="breadcrumb-separator hidden"> ‚Ä∫ </span>
        <span id="breadcrumb-project" class="breadcrumb-project hidden"></span>
      </h1>
    </div>
    <div class="header-right">
      <div class="ollama-status" id="ollama-status" title="Ollama AI Status">
        <span class="ollama-dot"></span>
        <span class="ollama-label">AI</span>
      </div>
      <div class="stats" id="stats">Loading...</div>
      <button class="settings-btn" onclick="showSettingsModal()" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Chat Modal -->
  <div id="chat-modal" class="chat-modal hidden">
    <div class="chat-container">
      <div class="chat-header">
        <h3>Ask about <span id="chat-project-name">Project</span></h3>
        <button class="chat-close" onclick="closeChat()">&times;</button>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="chat-welcome">
          <p>Ask questions about the codebase using local AI.</p>
          <p class="chat-hint">Examples: "How does authentication work?" or "What files handle user login?"</p>
        </div>
      </div>
      <div class="chat-input-container">
        <input type="text" id="chat-input" placeholder="Ask a question..." onkeydown="if(event.key==='Enter')sendMessage()">
        <button onclick="sendMessage()" id="chat-send">Send</button>
      </div>
    </div>
  </div>

  <!-- Alerts Banner -->
  <div id="alerts-banner" class="alerts-banner hidden">
    <div class="alerts-container" id="alerts-container">
      <!-- Alerts will be rendered here -->
    </div>
  </div>

  <!-- Portal View -->
  <div id="portal-view" class="portal-container">
    <div class="portal-header">
      <h2>Your Projects</h2>
      <div class="portal-tabs">
        <button class="portal-tab active" onclick="showPortalTab('projects', this)">Projects</button>
        <button class="portal-tab" onclick="showPortalTab('knowledge-base', this)">Knowledge Base</button>
        <button class="portal-tab" onclick="showPortalTab('reports', this)">Reports</button>
      </div>
    </div>

    <!-- Ollama Chat Quick Access -->
    <div class="ollama-quick-access" id="ollama-quick-access">
      <button class="ollama-chat-btn" onclick="showOllamaChat()">
        <svg class="ollama-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>Dash AI</span>
        <span class="ollama-chat-subtitle">Ask anything - portfolio insights, coding help, general questions</span>
      </button>
    </div>

    <div id="portal-grid" class="portal-grid">
      <div class="loading">Loading projects...</div>
    </div>

    <!-- Knowledge Base View -->
    <div id="knowledge-base-view" class="knowledge-base-view hidden">
      <div class="kb-header">
        <h3>Documentation Knowledge Base</h3>
        <p>Save frequently referenced documentation for quick access via chat.</p>
      </div>
      <div class="kb-add-form">
        <input type="url" id="kb-url-input" placeholder="https://docs.example.com/..." class="search-box" style="flex:1;">
        <button onclick="addKnowledgeBaseSource()" class="zoom-btn">Add URL</button>
      </div>
      <div id="kb-sources-list" class="kb-sources-list">
        <div class="loading">Loading...</div>
      </div>
    </div>

    <!-- Reports View -->
    <div id="reports-view" class="reports-view hidden">
      <div class="reports-header">
        <h3>Weekly Reports</h3>
        <button onclick="generateReport()" class="zoom-btn">Generate This Week's Report</button>
      </div>
      <div id="reports-list" class="reports-list">
        <div class="loading">Loading...</div>
      </div>
    </div>

  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="settings-modal hidden" onclick="if(event.target === this) hideSettingsModal()">
    <div class="settings-modal-content">
      <div class="settings-modal-header">
        <h3>Settings</h3>
        <button class="settings-close" onclick="hideSettingsModal()">&times;</button>
      </div>
      <div class="settings-modal-body">
        <div class="settings-section">
          <h4>API Status</h4>
          <p class="settings-desc">Direct API integration - no external dependencies.</p>

          <div id="api-status" class="api-status">
            <div class="api-item">
              <span class="status-dot" id="anthropic-status"></span>
              <span>Claude API (Anthropic)</span>
            </div>
            <div class="api-item">
              <span class="status-dot" id="tavily-status"></span>
              <span>Web Search (Tavily)</span>
            </div>
          </div>

          <p class="settings-hint">API keys are configured in the launchd plist.<br>Features: AI reports, web search, knowledge base extraction.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ollama Chat View (Standalone) -->
  <div id="ollama-chat-view" class="ollama-chat-view hidden">
    <div class="ollama-chat-header">
      <button class="back-btn" onclick="hideOllamaChat()">
        <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
          <path d="M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 1.06L4.81 7h8.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06z"/>
        </svg>
        Back to Projects
      </button>
      <h2>Dash AI</h2>
      <div class="ollama-chat-actions">
        <select id="ollama-context-mode" class="search-box" style="width: auto;" onchange="handleContextModeChange()">
          <option value="portfolio" selected>Portfolio Context</option>
          <option value="coding">Coding Help</option>
          <option value="fix">Fix Issue (with Claude)</option>
          <option value="general">General Chat</option>
        </select>
        <select id="ollama-project-select" class="search-box hidden" style="width: auto;">
          <option value="">Select a project...</option>
        </select>
        <button class="zoom-btn" onclick="clearOllamaChat()">Clear Chat</button>
      </div>
    </div>

    <div class="ollama-chat-main">
      <!-- Sidebar with suggestions -->
      <div class="ollama-chat-sidebar">
        <div class="sidebar-section">
          <h4>Quick Actions</h4>
          <button class="suggestion-btn" onclick="askOllama('Give me an overview of my project portfolio')">
            Portfolio Overview
          </button>
          <button class="suggestion-btn" onclick="askOllama('Which of my projects has the best code health and why?')">
            Best Code Health
          </button>
          <button class="suggestion-btn" onclick="askOllama('What common patterns exist across my projects?')">
            Common Patterns
          </button>
          <button class="suggestion-btn" onclick="askOllama('What technical debt should I prioritize?')">
            Technical Debt
          </button>
        </div>
        <div class="sidebar-section">
          <h4>Coding Help</h4>
          <button class="suggestion-btn" onclick="askOllama('Explain how React hooks work')">
            React Hooks
          </button>
          <button class="suggestion-btn" onclick="askOllama('Best practices for TypeScript')">
            TypeScript Tips
          </button>
          <button class="suggestion-btn" onclick="askOllama('How to structure a Firebase project')">
            Firebase Structure
          </button>
        </div>
        <div class="sidebar-section">
          <h4>Recent Topics</h4>
          <div id="ollama-recent-topics" class="recent-topics">
            <span class="no-topics">No recent topics</span>
          </div>
        </div>
        <div class="sidebar-section" id="handoff-section" style="display: none;">
          <h4>Claude Code Handoff</h4>
          <p class="sidebar-hint">Describe an issue above, then hand it off to Claude Code to fix.</p>
          <button class="suggestion-btn handoff-btn" onclick="handoffToClaude()" id="handoff-btn" disabled>
            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="margin-right: 8px;">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            Hand off to Claude
          </button>
          <div class="handoff-status" id="handoff-status"></div>
        </div>
      </div>

      <!-- Chat area -->
      <div class="ollama-chat-area">
        <div class="ollama-messages" id="ollama-messages">
          <div class="ollama-welcome">
            <div class="welcome-icon">‚ö°</div>
            <h3>Welcome to Dash AI</h3>
            <p>I have full context about all your projects. Ask me about:</p>
            <ul>
              <li><strong>Project Health</strong> - "What's wrong with GYST?" or "Which project needs work?"</li>
              <li><strong>Decisions & Patterns</strong> - "What tech stack does Jamelna use?"</li>
              <li><strong>Comparisons</strong> - "Compare health across my projects"</li>
              <li><strong>Fix Issues</strong> - Select "Fix Issue" mode to hand off to Claude Code</li>
            </ul>
            <p class="welcome-hint">Portfolio Context is active - I know about all 8 of your projects!</p>
          </div>
        </div>

        <div class="ollama-input-area">
          <div class="ollama-input-wrapper">
            <textarea id="ollama-input" placeholder="Ask me anything..." rows="1" onkeydown="handleOllamaKeydown(event)"></textarea>
            <div class="ollama-input-buttons">
              <button class="ollama-send-btn" onclick="sendOllamaMessage()" id="ollama-send-btn" title="Send message">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
              </button>
              <button class="ollama-claude-btn" onclick="showQuickHandoff()" id="ollama-claude-btn" title="Fix with Claude Code">
                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l4.59-4.58L18 11l-6 6z"/>
                </svg>
                <span>Claude</span>
              </button>
            </div>
          </div>
          <div class="ollama-input-hint">
            Press Enter to send ¬∑ Click Claude to hand off fixes
          </div>
        </div>

        <!-- Quick Handoff Modal -->
        <div id="quick-handoff-modal" class="quick-handoff-modal hidden">
          <div class="quick-handoff-content">
            <h3>Hand off to Claude Code</h3>
            <p>Select a project and describe what needs to be fixed:</p>
            <select id="quick-handoff-project" class="search-box">
              <option value="">Select a project...</option>
            </select>
            <textarea id="quick-handoff-issue" placeholder="Describe the issue or what you want Claude to fix..." rows="3"></textarea>
            <div class="quick-handoff-actions">
              <button class="zoom-btn" onclick="hideQuickHandoff()">Cancel</button>
              <button class="handoff-btn" onclick="executeQuickHandoff()">Send to Claude</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Container (Project View) -->
  <div class="container hidden" id="project-view">
    <!-- Main Content -->
    <div class="main">
      <!-- Tabs -->
      <div class="tabs">
        <div class="tab-group">
          <button class="tab active" data-tab="graph">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 14.25V1.75h1.25v12.5zM6 14.25v-7h1.25v7zm4.5-10v10h1.25v-10zm4.5 5.5v4.5h1.25v-4.5z"/></svg>
            Graph
          </button>
          <button class="tab" data-tab="files">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
            Files
          </button>
          <button class="tab" data-tab="functions">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M4.72 3.22a.75.75 0 0 1 1.06 0l3.5 3.5a.75.75 0 0 1 0 1.06l-3.5 3.5a.75.75 0 1 1-1.06-1.06L7.44 7.5 4.72 4.78a.75.75 0 0 1 0-1.06zm3.5 9.25a.75.75 0 0 1 .75-.75h6.25a.75.75 0 0 1 0 1.5H8.97a.75.75 0 0 1-.75-.75z"/></svg>
            Functions
          </button>
          <button class="tab" data-tab="schema">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h11A1.5 1.5 0 0 1 15 3.5v.75H1V3.5zM1 5.75h14v4.5H1v-4.5zm0 6V12.5A1.5 1.5 0 0 0 2.5 14h11a1.5 1.5 0 0 0 1.5-1.5v-.75H1z"/></svg>
            Schema
          </button>
          <button class="tab" data-tab="tasks">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 3.5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5v-9zm1 0v9h9v-9h-9zm1.5 1.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/></svg>
            Tasks
          </button>
        </div>
        <span class="tab-separator"></span>
        <div class="tab-group">
          <button class="tab" data-tab="health">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm9-3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM6.75 8a.75.75 0 0 0 0 1.5h1.5v1.75a.75.75 0 0 0 1.5 0V9.5a.75.75 0 0 0-.75-.75h-2.25z"/></svg>
            Health
          </button>
          <button class="tab" data-tab="ask">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-3.04-3.04zM11.5 7a4.5 4.5 0 1 0-9 0 4.5 4.5 0 0 0 9 0z"/></svg>
            Ask
          </button>
        </div>
        <span class="tab-separator"></span>
        <div class="tab-group">
          <button class="tab" data-tab="features">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8.878.392a1.75 1.75 0 0 0-1.756 0l-5.25 3.045A1.75 1.75 0 0 0 1 4.951v6.098c0 .624.332 1.2.872 1.514l5.25 3.045a1.75 1.75 0 0 0 1.756 0l5.25-3.045c.54-.313.872-.89.872-1.514V4.951c0-.624-.332-1.2-.872-1.514L8.878.392z"/></svg>
            Features
          </button>
          <button class="tab" data-tab="wireframe">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75zm1.75-.25a.25.25 0 0 0-.25.25V14.25c0 .138.112.25.25.25H14.25a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H1.75z"/><path d="M5 5v6h6V5z"/></svg>
            Wireframe
          </button>
          <button class="tab" data-tab="sessions">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5h-3.32Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"/></svg>
            Sessions
          </button>
          <button class="tab" data-tab="keys">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M6.5 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 1.5a3.5 3.5 0 1 1 2.376-6.082l4.27-4.27a.75.75 0 0 1 1.06 1.06l-1.292 1.293.86.86a.75.75 0 1 1-1.061 1.06l-.86-.859-.86.86.86.86a.75.75 0 1 1-1.061 1.06l-.86-.859-1.07 1.071A3.5 3.5 0 0 1 6.5 12Z"/></svg>
            Keys
          </button>
        </div>
        <span class="tab-separator"></span>
        <div class="tab-group">
          <button class="tab" data-tab="pixelart">
            <svg class="tab-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H1.75z"/><rect x="3" y="3" width="2" height="2"/><rect x="6" y="3" width="2" height="2"/><rect x="9" y="3" width="2" height="2"/><rect x="3" y="6" width="2" height="2"/><rect x="6" y="6" width="2" height="2"/><rect x="9" y="6" width="2" height="2"/><rect x="3" y="9" width="2" height="2"/><rect x="6" y="9" width="2" height="2"/><rect x="9" y="9" width="2" height="2"/></svg>
            Pixel Art
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content">
        <!-- Graph Tab -->
        <div id="tab-graph" class="tab-content">
          <div class="graph-toolbar">
            <div class="legend">
              <div class="legend-item"><div class="legend-dot" style="background: #f78166"></div> Screens</div>
              <div class="legend-item"><div class="legend-dot" style="background: #a371f7"></div> Components</div>
              <div class="legend-item"><div class="legend-dot" style="background: #58a6ff"></div> Services</div>
              <div class="legend-item"><div class="legend-dot" style="background: #3fb950"></div> Hooks</div>
            </div>
            <div class="zoom-controls">
              <button class="zoom-btn" id="zoom-in" title="Zoom In">+ Zoom In</button>
              <span class="zoom-level" id="zoom-level">100%</span>
              <button class="zoom-btn" id="zoom-out" title="Zoom Out">- Zoom Out</button>
              <button class="zoom-btn" id="zoom-fit" title="Fit to Screen">Fit</button>
              <button class="zoom-btn" id="zoom-reset" title="Reset View">Reset</button>
            </div>
          </div>
          <div id="graph" class="graph-container"></div>
        </div>

        <!-- Files Tab -->
        <div id="tab-files" class="tab-content hidden">
          <input type="text" class="search-box" id="file-search" placeholder="Search files...">
          <div id="file-list" class="file-list"></div>
        </div>

        <!-- Functions Tab -->
        <div id="tab-functions" class="tab-content hidden">
          <input type="text" class="search-box" id="func-search" placeholder="Search functions...">
          <div id="func-list" class="func-list"></div>
        </div>

        <!-- Schema Tab -->
        <div id="tab-schema" class="tab-content hidden">
          <div id="schema-grid" class="collection-grid"></div>
        </div>

        <!-- Tasks Tab -->
        <div id="tab-tasks" class="tab-content hidden">
          <div class="tasks-header">
            <h2>Active Tasks</h2>
            <button id="refresh-tasks" class="btn btn-secondary">Refresh</button>
          </div>
          <div id="tasks-list" class="tasks-list">
            <div class="loading">Loading tasks...</div>
          </div>
        </div>

        <!-- Health Tab -->
        <div id="tab-health" class="tab-content hidden">
          <!-- Task 12: Staleness Banner Container -->
          <div id="staleness-banner-container"></div>

          <div class="health-header">
            <div class="health-score-container">
              <div class="health-score" id="health-score">--</div>
              <div class="health-label">Health Score</div>
            </div>
            <div class="health-actions">
              <button class="zoom-btn" id="run-scan">Run Scan</button>
              <button class="zoom-btn fix-all-btn" id="fix-all" disabled>Fix All Safe (<span id="fixable-count">0</span>)</button>
              <span class="health-timestamp" id="health-timestamp">Never scanned</span>
              <div class="fix-buttons-group">
                <select id="fix-by-category" class="fix-dropdown" onchange="handleFixDropdown(this, 'category')">
                  <option value="">Fix by category...</option>
                  <option value="security" disabled>Security (0)</option>
                  <option value="performance" disabled>Performance (0)</option>
                  <option value="maintenance" disabled>Maintenance (0)</option>
                </select>
                <select id="fix-by-severity" class="fix-dropdown" onchange="handleFixDropdown(this, 'severity')">
                  <option value="">Fix by severity...</option>
                  <option value="critical" disabled>Critical (0)</option>
                  <option value="high" disabled>High (0)</option>
                  <option value="medium" disabled>Medium (0)</option>
                  <option value="low" disabled>Low (0)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="health-summary" id="health-summary">
            <div class="health-card critical">
              <div class="health-count" id="security-count">0</div>
              <div class="health-type">Security</div>
            </div>
            <div class="health-card warning">
              <div class="health-count" id="performance-count">0</div>
              <div class="health-type">Performance</div>
            </div>
            <div class="health-card info">
              <div class="health-count" id="duplicates-count">0</div>
              <div class="health-type">Duplicates</div>
            </div>
            <div class="health-card low">
              <div class="health-count" id="deadcode-count">0</div>
              <div class="health-type">Dead Code</div>
            </div>
          </div>

          <div class="card health-trends-card">
            <h3>Health Score Trends</h3>
            <canvas id="health-chart"></canvas>
          </div>

          <div id="trend-chart-container" class="trend-chart-container">
            <h4>Health Score Trend (Last 30 Days)</h4>
          </div>

          <div class="health-issues" id="health-issues">
            <div class="loading">Select a project and run a scan</div>
          </div>

          <!-- Dead Code Analysis (merged from Dead Code tab) -->
          <div class="card" style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleDeadCodeSection()">
              <h3 style="display: flex; align-items: center; gap: 8px;">
                <span id="deadcode-toggle-icon">‚ñ∂</span>
                Dead Code Analysis
                <span class="badge" id="deadcode-total-count" style="background: var(--warning); color: var(--bg-primary);">0</span>
              </h3>
              <div class="deadcode-filters" id="deadcode-filters" style="display: none;">
                <select id="deadcode-type-filter" class="search-box" style="width: auto;" onclick="event.stopPropagation()">
                  <option value="all">All Types</option>
                  <option value="orphan_file">Orphan Files</option>
                  <option value="unused_export">Unused Exports</option>
                  <option value="unused_function">Unused Functions</option>
                </select>
                <select id="deadcode-confidence-filter" class="search-box" style="width: auto;" onclick="event.stopPropagation()">
                  <option value="all">All Confidence</option>
                  <option value="high">High</option>
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>
            </div>

            <div id="deadcode-sections" class="deadcode-sections" style="display: none; margin-top: 16px;">
              <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                <h4 style="margin-bottom: 8px; color: var(--text-primary);">Orphan Files <span class="badge" id="orphan-count">0</span></h4>
                <div id="orphan-list" class="deadcode-list" style="max-height: 200px; overflow-y: auto;"></div>
              </div>

              <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                <h4 style="margin-bottom: 8px; color: var(--text-primary);">Unused Exports <span class="badge" id="exports-count">0</span></h4>
                <div id="exports-list" class="deadcode-list" style="max-height: 200px; overflow-y: auto;"></div>
              </div>

              <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px;">
                <h4 style="margin-bottom: 8px; color: var(--text-primary);">Unused Functions <span class="badge" id="functions-unused-count">0</span></h4>
                <div id="functions-unused-list" class="deadcode-list" style="max-height: 200px; overflow-y: auto;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Unified Ask Tab -->
        <div id="tab-ask" class="tab-content hidden">
          <div class="ask-header">
            <h2>Ask Anything</h2>
            <p style="color: var(--text-muted); margin-top: 8px;">Search your codebase by meaning - ask questions, find files, explore concepts</p>
          </div>

          <div class="card" style="margin-top: 16px;">
            <div class="ask-input-wrapper" style="display: flex; gap: 8px;">
              <input type="text" class="search-box" id="ask-input" placeholder="What do you want to know? (e.g., 'how does authentication work?', 'where is the login screen?')" style="flex: 1;">
              <button class="zoom-btn fix-all-btn" id="ask-submit">Ask</button>
            </div>
            <div class="ask-examples" style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 8px;">
              <button class="query-example-btn" onclick="setAskQuery('how does authentication work?')">Auth flow</button>
              <button class="query-example-btn" onclick="setAskQuery('where is the login screen?')">Login screen</button>
              <button class="query-example-btn" onclick="setAskQuery('what collections store user data?')">User data</button>
              <button class="query-example-btn" onclick="setAskQuery('how does navigation work?')">Navigation</button>
              <button class="query-example-btn" onclick="setAskQuery('payment processing')">Payments</button>
            </div>
          </div>

          <!-- Answer Section -->
          <div id="ask-answer" class="card" style="margin-top: 16px; display: none;">
            <div style="display: flex; align-items: flex-start; gap: 12px;">
              <div style="font-size: 24px;">üí°</div>
              <div>
                <div id="ask-answer-text" style="color: var(--text-primary); line-height: 1.6;"></div>
              </div>
            </div>
          </div>

          <!-- Results Section -->
          <div id="ask-results" class="card" style="margin-top: 16px; min-height: 200px;">
            <div class="loading" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
              <div>Ask a question to search your codebase</div>
              <div style="font-size: 12px; margin-top: 8px; color: var(--text-subtle);">Uses semantic understanding to find relevant files and concepts</div>
            </div>
          </div>
        </div>

        <!-- Features Tab -->
        <div id="tab-features" class="tab-content hidden">
          <div class="features-layout">
            <div class="features-section">
              <div class="card">
                <h3>Feature Modules</h3>
                <div id="features-grid" class="features-grid"></div>
              </div>
            </div>

            <div class="preferences-section">
              <div class="card">
                <h3>Coding Preferences</h3>
                <div id="preferences-editor">
                  <div class="pref-section">
                    <h4>Technology Choices</h4>
                    <div id="pref-use"></div>
                  </div>
                  <div class="pref-section">
                    <h4>Conventions</h4>
                    <div id="pref-conventions"></div>
                    <button class="zoom-btn" id="add-convention" style="margin-top: 8px;">+ Add Convention</button>
                  </div>
                  <div class="pref-section">
                    <h4>Patterns</h4>
                    <div id="pref-patterns"></div>
                  </div>
                </div>
                <div class="pref-actions">
                  <button class="zoom-btn fix-all-btn" id="save-preferences">Save Changes</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Wireframe Tab -->
        <div id="tab-wireframe" class="tab-content hidden">
          <div class="wireframe-header">
            <h2>App Wireframe & Screen Map</h2>
            <p style="color: var(--text-muted); margin-top: 8px;">Visual overview of screens, navigation flow, and data dependencies</p>
          </div>

          <div class="wireframe-stats">
            <div class="card" style="text-align: center;">
              <div style="font-size: 32px; color: var(--accent-blue); font-weight: bold;" id="wf-screen-count">-</div>
              <div style="color: var(--text-muted); font-size: 13px;">Screens</div>
            </div>
            <div class="card" style="text-align: center;">
              <div style="font-size: 32px; color: var(--accent-cyan); font-weight: bold;" id="wf-collection-count">-</div>
              <div style="color: var(--text-muted); font-size: 13px;">Collections</div>
            </div>
            <div class="card" style="text-align: center;">
              <div style="font-size: 32px; color: var(--accent-orange); font-weight: bold;" id="wf-function-count">-</div>
              <div style="color: var(--text-muted); font-size: 13px;">Functions</div>
            </div>
            <div class="card" style="text-align: center;">
              <div style="font-size: 32px; color: var(--accent-purple); font-weight: bold;" id="wf-nav-links">-</div>
              <div style="color: var(--text-muted); font-size: 13px;">Nav Links</div>
            </div>
          </div>

          <!-- Navigation Flow Controls -->
          <div class="card" style="margin-bottom: 16px;">
            <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap; justify-content: space-between;">
              <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <label style="color: var(--text-muted); font-size: 13px;">Filter by Stack:</label>
                  <select id="wf-stack-filter" class="search-box" style="width: auto; min-width: 150px;">
                    <option value="all">All Stacks</option>
                  </select>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <label style="color: var(--text-muted); font-size: 13px;">Focus Screen:</label>
                  <select id="wf-focus-screen" class="search-box" style="width: auto; min-width: 200px;">
                    <option value="">Show All</option>
                  </select>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <label style="color: var(--text-muted); font-size: 13px;">Depth:</label>
                  <select id="wf-focus-depth" class="search-box" style="width: auto;">
                    <option value="1">1 level</option>
                    <option value="2" selected>2 levels</option>
                    <option value="3">3 levels</option>
                  </select>
                </div>
                <button class="zoom-btn" onclick="resetWireframeFilters()">Reset Filters</button>
              </div>
              <div class="view-toggle">
                <button class="view-btn active" data-wf-view="mermaid" onclick="setWireframeView('mermaid')">Flow Chart</button>
                <button class="view-btn" data-wf-view="graph" onclick="setWireframeView('graph')">Interactive</button>
                <button class="view-btn" data-wf-view="tree" onclick="setWireframeView('tree')">Tree List</button>
              </div>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: minmax(0, 1fr) 350px; gap: 24px;">
            <!-- Left: Navigation Flow Views -->
            <div class="card" style="min-width: 0; overflow: hidden;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3>Navigation Flow</h3>
                <span id="wf-filter-info" style="color: var(--text-muted); font-size: 12px;"></span>
              </div>
              <!-- Mermaid Flow Chart View -->
              <div id="wf-mermaid-container" class="wf-view-container" style="background: var(--bg-primary); border-radius: 8px; padding: 20px; min-height: 500px; overflow: auto; max-width: 100%;">
                <div class="loading">Loading navigation flow...</div>
              </div>
              <!-- Interactive Graph View -->
              <div id="wf-graph-container" class="wf-view-container" style="display: none; height: 600px; position: relative; background: var(--bg-primary); border-radius: 8px;">
                <div id="wf-graph-controls" style="position: absolute; top: 10px; right: 10px; z-index: 100; display: flex; gap: 8px;">
                  <button onclick="wfGraphNetwork && wfGraphNetwork.moveTo({scale: wfGraphNetwork.getScale() * 1.3})" class="zoom-btn">+</button>
                  <button onclick="wfGraphNetwork && wfGraphNetwork.moveTo({scale: wfGraphNetwork.getScale() / 1.3})" class="zoom-btn">-</button>
                  <button onclick="wfGraphNetwork && wfGraphNetwork.fit()" class="zoom-btn">Fit</button>
                </div>
                <div id="wf-graph-network" style="width: 100%; height: 100%;"></div>
              </div>
              <!-- Tree List View -->
              <div id="wf-tree-container" class="wf-view-container" style="display: none; background: var(--bg-primary); border-radius: 8px; padding: 20px; min-height: 500px; max-height: 600px; overflow: auto;">
                <div class="loading">Loading tree view...</div>
              </div>
            </div>

            <!-- Right: Screen List -->
            <div class="card">
              <h3 style="margin-bottom: 16px;">Screen Inventory</h3>
              <input type="text" id="wf-screen-search" class="search-box" placeholder="Search screens...">
              <div id="wf-screen-list" class="file-list" style="max-height: 600px;">
                <div class="loading">Loading screens...</div>
              </div>
            </div>
          </div>

          <!-- Orphan Screens Detection -->
          <div id="wf-orphans" class="card" style="margin-top: 16px; display: none;">
            <h3 style="margin-bottom: 12px; color: var(--warning);">‚ö†Ô∏è Orphan Screens</h3>
            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 12px;">These screens are not reachable from the main navigation flow:</p>
            <div id="wf-orphan-list" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
          </div>

          <!-- Screen Detail Modal -->
          <div id="wf-screen-detail" class="card" style="margin-top: 24px; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 id="wf-detail-title">Screen Details</h3>
              <button onclick="document.getElementById('wf-screen-detail').style.display='none'" class="zoom-btn">Close</button>
            </div>
            <div id="wf-detail-content"></div>
          </div>
        </div>

        <!-- Sessions Tab -->
        <div id="tab-sessions" class="tab-content hidden">
          <div class="sessions-header">
            <h2>Session History & Observations</h2>
            <p style="color: var(--text-muted); margin-top: 8px;">Browse past decisions, patterns learned, and bugs fixed</p>
          </div>

          <div class="sessions-controls card" style="margin-top: 16px;">
            <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: var(--text-muted); font-size: 13px;">Search:</label>
                <input type="text" class="search-box" id="session-search" placeholder="Search observations..." style="width: 250px;">
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: var(--text-muted); font-size: 13px;">Category:</label>
                <select id="session-category" class="search-box" style="width: auto;">
                  <option value="">All Categories</option>
                  <option value="decision">üéØ Decisions</option>
                  <option value="pattern">üîÑ Patterns</option>
                  <option value="bugfix">üêõ Bug Fixes</option>
                  <option value="gotcha">‚ö†Ô∏è Gotchas</option>
                  <option value="feature">‚ú® Features</option>
                  <option value="implementation">üîß Implementations</option>
                </select>
              </div>
              <button class="zoom-btn" id="search-sessions">Search</button>
              <button class="zoom-btn" id="list-sessions" style="margin-left: auto;">List Recent Sessions</button>
            </div>
          </div>

          <div class="sessions-stats" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-top: 16px;">
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--accent-blue); font-weight: bold;" id="stat-decisions">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">üéØ Decisions</div>
            </div>
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--accent-purple); font-weight: bold;" id="stat-patterns">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">üîÑ Patterns</div>
            </div>
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--accent-green); font-weight: bold;" id="stat-bugfixes">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">üêõ Bug Fixes</div>
            </div>
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--warning); font-weight: bold;" id="stat-gotchas">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">‚ö†Ô∏è Gotchas</div>
            </div>
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--accent-cyan); font-weight: bold;" id="stat-features">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">‚ú® Features</div>
            </div>
            <div class="card" style="text-align: center; padding: 12px;">
              <div style="font-size: 24px; color: var(--accent-orange); font-weight: bold;" id="stat-implementations">0</div>
              <div style="color: var(--text-muted); font-size: 12px;">üîß Impls</div>
            </div>
          </div>

          <div id="sessions-list" class="card" style="margin-top: 16px; min-height: 300px;">
            <div class="loading">Search for observations or list recent sessions</div>
          </div>
        </div>

        <!-- Keys Tab -->
        <div id="tab-keys" class="tab-content hidden">
          <div class="keys-header">
            <div>
              <h2>API Keys</h2>
              <p style="color: var(--text-muted); margin-top: 8px;">Securely manage API keys across projects (stored in macOS Keychain)</p>
            </div>
            <button class="zoom-btn fix-all-btn" id="add-key-btn">+ Add Key</button>
          </div>

          <div class="keys-controls card" style="margin-top: 16px;">
            <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
              <input type="text" class="search-box" id="keys-search" placeholder="Search keys..." style="width: 250px;">
              <select id="keys-project-filter" class="search-box" style="width: auto;">
                <option value="">All Projects</option>
              </select>
            </div>
          </div>

          <div id="keys-list" class="card" style="margin-top: 16px; min-height: 200px;">
            <div class="loading">Loading keys...</div>
          </div>
        </div>

        <!-- Pixel Art Tab -->
        <div id="tab-pixelart" class="tab-content hidden">
          <div class="pixelart-header">
            <h2>Pixel Art Generator</h2>
            <p style="color: var(--text-muted); margin-top: 8px;">Generate 16x16 pixel art tiles for CodeTale themes</p>
          </div>

          <!-- Generator Type Selection -->
          <div class="card" style="margin-top: 16px;">
            <h3 style="margin-bottom: 16px;">Generator Type</h3>
            <div class="pixelart-type-buttons" style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button class="pixelart-type-btn active" data-type="floor" onclick="selectPixelArtType('floor')">
                <span style="font-size: 24px;">üü´</span>
                <span>Floors</span>
              </button>
              <button class="pixelart-type-btn" data-type="item" onclick="selectPixelArtType('item')">
                <span style="font-size: 24px;">üß™</span>
                <span>Items</span>
              </button>
              <button class="pixelart-type-btn" data-type="decoration" onclick="selectPixelArtType('decoration')">
                <span style="font-size: 24px;">üåø</span>
                <span>Decorations</span>
              </button>
              <button class="pixelart-type-btn" data-type="batch" onclick="selectPixelArtType('batch')">
                <span style="font-size: 24px;">üì¶</span>
                <span>Batch Theme</span>
              </button>
            </div>
          </div>

          <!-- Options Panel -->
          <div class="card" style="margin-top: 16px;">
            <h3 style="margin-bottom: 16px;">Options</h3>

            <!-- Floor Options -->
            <div id="floor-options" class="pixelart-options">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Theme</label>
                  <select id="floor-theme" class="search-box" style="width: 100%;">
                    <option value="dungeon">Dungeon</option>
                    <option value="forest">Forest</option>
                    <option value="castle">Castle</option>
                    <option value="cave">Cave</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Variant</label>
                  <select id="floor-variant" class="search-box" style="width: 100%;">
                    <option value="basic">Basic</option>
                    <option value="cracked">Cracked</option>
                    <option value="debris">Debris</option>
                    <option value="mossy">Mossy</option>
                    <option value="stone">Stone</option>
                    <option value="grass">Grass</option>
                    <option value="dirt">Dirt</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Seed</label>
                  <input type="number" id="floor-seed" class="search-box" style="width: 100%;" placeholder="Random">
                </div>
              </div>
            </div>

            <!-- Item Options -->
            <div id="item-options" class="pixelart-options" style="display: none;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Type</label>
                  <select id="item-type" class="search-box" style="width: 100%;" onchange="updateItemColors()">
                    <option value="potion">Potion</option>
                    <option value="gem">Gem</option>
                    <option value="coin">Coin</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Color</label>
                  <select id="item-color" class="search-box" style="width: 100%;">
                    <option value="red">Red</option>
                    <option value="blue">Blue</option>
                    <option value="green">Green</option>
                    <option value="yellow">Yellow</option>
                    <option value="purple">Purple</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Seed</label>
                  <input type="number" id="item-seed" class="search-box" style="width: 100%;" placeholder="Random">
                </div>
              </div>
            </div>

            <!-- Decoration Options -->
            <div id="decoration-options" class="pixelart-options" style="display: none;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Type</label>
                  <select id="decoration-type" class="search-box" style="width: 100%;">
                    <option value="rock">Rock</option>
                    <option value="grass_tuft">Grass Tuft</option>
                    <option value="flower">Flower</option>
                    <option value="mushroom">Mushroom</option>
                    <option value="bush">Bush</option>
                    <option value="bones">Bones</option>
                    <option value="crystal">Crystal</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Theme</label>
                  <select id="decoration-theme" class="search-box" style="width: 100%;">
                    <option value="dungeon">Dungeon</option>
                    <option value="forest">Forest</option>
                    <option value="castle">Castle</option>
                    <option value="cave">Cave</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Seed</label>
                  <input type="number" id="decoration-seed" class="search-box" style="width: 100%;" placeholder="Random">
                </div>
              </div>
            </div>

            <!-- Batch Options -->
            <div id="batch-options" class="pixelart-options" style="display: none;">
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Theme</label>
                  <select id="batch-theme" class="search-box" style="width: 100%;">
                    <option value="dungeon">Dungeon</option>
                    <option value="forest">Forest</option>
                    <option value="castle">Castle</option>
                    <option value="cave">Cave</option>
                  </select>
                </div>
                <div>
                  <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Seed</label>
                  <input type="number" id="batch-seed" class="search-box" style="width: 100%;" placeholder="Random">
                </div>
              </div>
              <div style="margin-top: 16px;">
                <label style="color: var(--text-muted); font-size: 13px; display: block; margin-bottom: 8px;">Include</label>
                <div style="display: flex; gap: 16px;">
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="batch-floors" checked>
                    <span>Floors</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="batch-items" checked>
                    <span>Items</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="batch-decorations" checked>
                    <span>Decorations</span>
                  </label>
                </div>
              </div>
            </div>

            <div style="margin-top: 16px;">
              <button class="zoom-btn fix-all-btn" id="generate-pixelart" onclick="generatePixelArt()">Generate</button>
              <button class="zoom-btn" id="randomize-seed" onclick="randomizeSeed()" style="margin-left: 8px;">Randomize Seed</button>
            </div>
          </div>

          <!-- Preview Area -->
          <div class="card" style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3>Preview</h3>
              <div style="display: flex; gap: 8px;">
                <button class="zoom-btn" id="download-pixelart" onclick="downloadPixelArt()" disabled>Download PNG</button>
                <button class="zoom-btn" id="save-to-theme" onclick="saveToTheme()" disabled>Save to Theme</button>
              </div>
            </div>
            <div id="pixelart-preview" class="pixelart-preview" style="min-height: 200px; display: flex; align-items: center; justify-content: center; background: var(--bg-primary); border-radius: 8px; padding: 20px;">
              <div style="text-align: center; color: var(--text-muted);">
                <div style="font-size: 48px; margin-bottom: 12px;">üé®</div>
                <div>Select options and click Generate</div>
              </div>
            </div>
          </div>

          <!-- Generated Gallery -->
          <div class="card" style="margin-top: 16px;">
            <h3 style="margin-bottom: 16px;">Generated Gallery</h3>
            <div id="pixelart-gallery" class="pixelart-gallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; min-height: 100px;">
              <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 20px;">
                Generated tiles will appear here
              </div>
            </div>
          </div>

          <!-- CodeTale Server Status -->
          <div class="card" style="margin-top: 16px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div id="codetale-status" style="width: 12px; height: 12px; border-radius: 50%; background: var(--text-muted);"></div>
              <span style="color: var(--text-muted); font-size: 13px;">CodeTale Server: <span id="codetale-status-text">Checking...</span></span>
              <button class="zoom-btn" onclick="checkCodeTaleServer()" style="margin-left: auto;">Check Connection</button>
            </div>
          </div>
        </div>

        <!-- Add/Edit Key Modal -->
        <div id="key-modal" class="modal hidden">
          <div class="modal-backdrop" onclick="closeKeyModal()"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="key-modal-title">Add New Key</h3>
              <button class="modal-close" onclick="closeKeyModal()">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="key-name">Key Name</label>
                <input type="text" id="key-name" class="search-box" placeholder="e.g., CLAUDE_API_KEY" style="width: 100%;">
                <small style="color: var(--text-muted);">Will be converted to UPPERCASE_WITH_UNDERSCORES</small>
              </div>
              <div class="form-group">
                <label for="key-value">Key Value</label>
                <div style="position: relative;">
                  <input type="password" id="key-value" class="search-box" placeholder="Paste your API key..." style="width: 100%; padding-right: 40px;">
                  <button class="key-toggle-visibility" onclick="toggleKeyValueVisibility()" title="Toggle visibility" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted);">
                    <svg id="key-visibility-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 3.5a4.5 4.5 0 0 0-4.496 4.306l-.004.194A4.5 4.5 0 0 0 8 12.5a4.5 4.5 0 0 0 4.496-4.306l.004-.194A4.5 4.5 0 0 0 8 3.5Zm0 7.5a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm0-5a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"/></svg>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label for="key-description">Description (optional)</label>
                <input type="text" id="key-description" class="search-box" placeholder="e.g., Anthropic API key for Claude" style="width: 100%;">
              </div>
              <div class="form-group">
                <label>Sync to Projects</label>
                <div id="key-projects-checkboxes" class="projects-checkboxes"></div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="zoom-btn" onclick="closeKeyModal()">Cancel</button>
              <button class="zoom-btn fix-all-btn" id="save-key-btn" onclick="saveKey()">Save Key</button>
            </div>
          </div>
        </div>

        <!-- Sync Modal -->
        <div id="sync-modal" class="modal hidden">
          <div class="modal-backdrop" onclick="closeSyncModal()"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3>Sync <span id="sync-key-name"></span></h3>
              <button class="modal-close" onclick="closeSyncModal()">&times;</button>
            </div>
            <div class="modal-body">
              <p style="margin-bottom: 16px; color: var(--text-muted);">Select projects to sync this key to:</p>
              <div id="sync-projects-checkboxes" class="projects-checkboxes"></div>
            </div>
            <div class="modal-footer">
              <button class="zoom-btn" onclick="closeSyncModal()">Cancel</button>
              <button class="zoom-btn fix-all-btn" onclick="performSync()">Sync to Selected</button>
            </div>
          </div>
        </div>

        <!-- Sync Results Modal -->
        <div id="sync-results-modal" class="modal hidden">
          <div class="modal-backdrop" onclick="closeSyncResultsModal()"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3>Sync Complete</h3>
              <button class="modal-close" onclick="closeSyncResultsModal()">&times;</button>
            </div>
            <div class="modal-body">
              <div id="sync-results-list"></div>
            </div>
            <div class="modal-footer">
              <button class="zoom-btn fix-all-btn" onclick="closeSyncResultsModal()">Done</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
